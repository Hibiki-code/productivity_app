<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Life OS</title>

  <link
    href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&family=Nunito:wght@600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <style>
    /* ... existing styles ... */
    #migration-btn {
      position: fixed !important;
      top: 10px !important;
      left: 10px !important;
      bottom: auto !important;
      width: 200px !important;
      height: 60px !important;
      font-size: 20px !important;
      z-index: 2147483647 !important;
      background: red !important;
      color: white !important;
      border: 4px solid yellow !important;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5) !important;
      cursor: pointer;
    }

    :root {
      --bg-color: #FDF9E8;
      --primary: #5E6CD8;
      --text: #4A4A4A;
      --text-sub: #999;
      --warm-orange: #FF9F43;
      --bg-card: #FFF;
      --radius: 18px;
    }

    body {
      font-family: 'M PLUS Rounded 1c', 'Nunito', sans-serif;
      background-color: var(--bg-color);
      color: var(--text);
      margin: 0;
      padding: 0;
      padding-bottom: 90px;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    .header {
      padding: 30px 20px 10px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--bg-color);
    }

    .header-title {
      font-size: 20px;
      font-weight: 800;
      color: #555;
    }

    .view {
      display: none;
      padding: 0 16px;
    }

    .view.active {
      display: block;
    }

    /* Task Sections */
    .section-container {
      background: rgba(0, 0, 0, 0.02);
      border-radius: var(--radius);
      margin-bottom: 15px;
      overflow: hidden;
    }

    .section-header {
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      font-weight: 800;
      font-size: 14px;
    }

    .list-content {
      display: grid;
      grid-template-rows: 1fr;
      transition: grid-template-rows 0.3s ease-out;
    }

    .list-content>div {
      overflow: hidden;
    }

    .list-content.collapsed {
      grid-template-rows: 0fr;
    }

    .habit-list-container {
      display: grid;
      grid-template-rows: 1fr;
      transition: grid-template-rows 0.3s ease-out;
    }

    .habit-list-container>div {
      overflow: hidden;
    }

    .habit-list-container.collapsed {
      grid-template-rows: 0fr;
    }

    .toggle-icon {
      transition: transform 0.3s;
      display: inline-block;
    }

    .section-header.closed .toggle-icon {
      transform: rotate(180deg);
    }

    .task-item {
      background: #FFF;
      padding: 14px 16px;
      border-radius: 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
    }

    .task-item.done {
      opacity: 0.6;
    }

    .task-check {
      width: 22px;
      height: 22px;
      border: 2px solid #E0E0E0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .task-item.done .task-check {
      background: #CCC;
      border-color: #CCC;
    }

    .task-content {
      flex: 1;
      font-weight: 700;
      font-size: 15px;
    }

    .task-item.done .task-content {
      text-decoration: line-through;
      color: #999;
    }

    .btn-add-circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #AAA;
      font-size: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    /* Habit Styles (TickTick) */
    .section-habit {
      margin-bottom: 15px;
      background: rgba(0, 0, 0, 0.02);
      border-radius: 16px;
      overflow: hidden;
    }



    .habit-item {
      background: white;
      border-radius: 16px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);
    }

    .habit-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #81C784;
      /* Unified Green */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-right: 15px;
      color: white;
    }

    /* REMOVED Colorful Logic per user request */


    .habit-info {
      flex: 1;
    }

    .habit-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 2px;
    }

    .habit-stats-right {
      text-align: right;
      min-width: 80px;
    }

    .habit-check-area {
      padding: 10px;
      margin-left: 10px;
      cursor: pointer;
    }

    .check-circle {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid #EEE;
    }

    .habit-item.done {
      opacity: 0.7;
    }

    .habit-item.done .check-circle {
      background: var(--warm-orange);
      border-color: var(--warm-orange);
      position: relative;
    }

    .habit-item.done .check-circle::after {
      content: 'âœ“';
      color: white;
      font-size: 14px;
      position: absolute;
      top: 1px;
      left: 5px;
    }

    /* Calendar Strip */
    .calendar-strip {
      display: flex;
      justify-content: space-between;
      padding: 10px 15px;
      background: var(--bg-color);
      margin-bottom: 10px;
    }

    .date-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 6px;
      border-radius: 20px;
      min-width: 36px;
    }

    .date-item.active {
      background: #FFF;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .date-label {
      font-size: 10px;
      font-weight: 700;
      color: #999;
    }

    /* --- SECTION CONTAINERS (Grouping) --- */
    .section-container {
      margin-bottom: 5px;
      background: transparent;
      border-radius: 12px;
      transition: background 0.2s, box-shadow 0.2s;
      overflow: visible;
      /* Ensure swipe actions aren't clipped */
    }

    .section-container.expanded {
      background: transparent;
      /* Transparent to show gaps */
      padding-bottom: 5px;
      margin-bottom: 12px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      /* Slightly more padding */
      background: #FFFFFF;
      border-radius: 12px !important;
      /* Full radius by default */
      cursor: pointer;
      font-size: 0.95em;
      margin-bottom: 10px;
      /* Gap between header and first task */
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      /* Restore shadow for card look */
    }

    .section-container.expanded .section-header {
      /* Keep rounded corners */
      border-bottom-left-radius: 12px;
      border-bottom-right-radius: 12px;
      /* No Separator line */
      border-bottom: none;
    }

    .list-content {
      padding: 0;
      overflow: visible;
    }

    .list-content>div {
      /* Inner wrapper */
    }

    /* Task Item adjustments for inside card */
    .task-wrapper {
      margin-bottom: 0;
      /* Remove vertical gaps for unity */
      box-shadow: none;
      /* Remove shadow inside card? Or keep? */
      /* If we want "unity", maybe tasks should look cleaner */
      border-bottom: 1px solid #eee;
      /* Light separator */
      border-radius: 0;
      /* Square borders for stack */
      background: transparent;
      /* Slightly distinct from white card? or just white */
    }

    .task-wrapper:last-child {
      margin-bottom: 0;
      border-bottom: none;
    }

    /* Enforce White Background on Task Item always */
    .task-item {
      background: #FFF !important;
      /* Always opaque */
      padding: 8px 14px;
      position: relative;
      z-index: 1;
      /* Ensure above actions */
    }

    /* ... (skipped done styles) ... */

    /* Swipe actions */
    .task-wrapper {
      position: relative;
      overflow: visible;
    }

    .task-actions {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      /* z-index handled inline (1) */
      padding: 0 15px;
      box-sizing: border-box;
      opacity: 1;
      /* visibility handled inline (hidden default) */
      background: transparent;
    }

    .task-actions.left {
      justify-content: flex-start;
    }

    .task-actions.right {
      justify-content: flex-end;
    }

    .task-item {
      position: relative;
      z-index: 10;
      /* Ensure item is above actions */
    }

    .task-actions .action-btn {
      pointer-events: auto;
      flex-shrink: 0;
      /* Critical: Prevent collapse */
      min-width: 50px;
      /* Critical: Ensure size */
      width: 50px;
      height: 100%;
      border-radius: 8px;
      /* Slightly rounded */
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      box-shadow: none;
      margin-left: 5px;
    }

    .delete-btn {
      background: #FF5252;
    }

    .archive-btn {
      background: #5E6CD8;
    }

    .unarchive {
      background: #8D6E63;
    }

    /* For Archive List - ensure circular buttons if needed? */
    .action-btn.round {
      border-radius: 50%;
    }

    .date-item.active .date-num {
      background: var(--warm-orange);
      color: white;
    }

    /* Modals */
    .modal-fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-color);
      z-index: 3000;
      display: none;
      flex-direction: column;
      animation: fadeIn 0.2s;
      overflow-y: auto;
    }

    .modal-fullscreen.open {
      display: flex;
    }

    .detail-header {
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .detail-hero {
      text-align: center;
      padding: 20px;
    }

    .detail-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .detail-title {
      font-size: 22px;
      font-weight: 800;
      color: #444;
    }

    .detail-stats-row {
      display: flex;
      justify-content: space-around;
      padding: 10px 20px;
    }

    .stat-box {
      background: white;
      border-radius: 16px;
      padding: 15px;
      width: 40%;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
    }

    .stat-num {
      font-size: 24px;
      font-weight: 800;
      color: var(--primary);
    }

    .stat-label {
      font-size: 11px;
      color: #999;
      font-weight: 700;
      margin-top: 4px;
    }

    .calendar-card {
      background: white;
      border-radius: 20px;
      margin: 20px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
    }

    .cal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      font-weight: 800;
      color: #555;
    }

    .cal-arrow {
      font-size: 24px;
      padding: 0 10px;
      cursor: pointer;
      color: #888;
    }

    .cal-arrow.disabled {
      opacity: 0.2;
      pointer-events: none;
    }

    /* Class added by JS */

    .detail-cal-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      text-align: center;
    }

    .cal-cell {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      border-radius: 50%;
      font-weight: 700;
      color: #555;
      box-sizing: border-box;
      /* Important for border */
    }

    .cal-header-cell {
      color: #999;
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    /* Calendar Status Colors */
    .cal-cell.status-done {
      background: var(--warm-orange);
      color: white;
      border: 2px solid var(--warm-orange);
      /* Match size */
    }

    .cal-cell.status-failed {
      /* existing styles... */
    }

    /* Completed Habit Styling */
    #list-habit-checked .task-item {
      opacity: 0.5;
      filter: grayscale(100%);
      transition: opacity 0.3s, filter 0.3s;
    }

    /* Ensure opacity is full when not in checked list */
    .task-item {
      opacity: 1;
      transition: opacity 0.3s, filter 0.3s;
    }

    background: transparent;
    color: #555;
    border: 3px solid #D0D0D0;
    /* Visible Gray Ring */
    }

    /* Gray for missed */
    .cal-cell.status-none {}

    /* Future or none */

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 70px;
      background: white;
      border-top: 1px solid #F0F0F0;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #CCC;
      width: 60px;
      font-size: 10px;
      font-weight: 700;
    }

    .nav-item.active {
      color: var(--primary);
    }

    .nav-icon {
      font-size: 22px;
      margin-bottom: 4px;
    }

    /* Modal Simple */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      z-index: 3100;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.open {
      display: flex;
    }

    .modal-box {
      background: white;
      width: 85%;
      max-width: 360px;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .btn-save {
      width: 100%;
      padding: 14px;
      background: #333;
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      margin-top: 10px;
      cursor: pointer;
    }

    .input-std {
      width: 100%;
      padding: 12px;
      border: 1px solid #EEE;
      border-radius: 8px;
      box-sizing: border-box;
      margin-bottom: 10px;
      font-family: inherit;
    }

    .glass-header {
      position: sticky;
      top: 0;
      z-index: 100;
      /* Parent handles layout & text, background handled by ::before */
      padding: 35px 20px 15px;
      font-size: 28px;
      font-weight: 800;
      color: var(--text);
      letter-spacing: -0.5px;
      isolation: isolate;
      /* Create stacking context */
    }

    .glass-header::before {
      content: "";
      position: absolute;
      inset: 0;
      z-index: -1;

      /* Blur Effect */
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);

      /* Background Gradient: Top(0.25) -> Bottom(0) Smooth Fade */
      background: linear-gradient(to bottom,
          rgba(253, 249, 232, 0.25) 0%,
          rgba(253, 249, 232, 0) 100%);

      /* Smooth Blur Fade-out using Mask */
      -webkit-mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
      mask-image: linear-gradient(to bottom, black 50%, transparent 100%);

      pointer-events: none;
    }

    .toggle-icon {
      transition: transform 0.3s ease;
      font-size: 12px;
      color: #999;
    }

    /* Calendar Strip Sticky */
    .calendar-strip {
      position: sticky;
      top: 85px;
      /* Approximate header height */
      z-index: 90;
      background: transparent !important;
      /* Completely transparent */
      padding: 10px 0;
      /* Remove border if it exists or keep it? User said "completely transparent" bar.
  Usually strip has border-bottom. Let's inspect/assume no background. */
      display: flex;
      justify-content: space-around;
      /* margin-bottom: 20px; -> Keep margin */
    }

    /* Sortable Feedback */
    .sortable-ghost {
      opacity: 0.4;
      background: #f0f0f0;
    }

    .sortable-drag {
      cursor: grabbing;
      opacity: 0.9;
      transform: scale(1.02);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      z-index: 9999;
    }

    .view {
      display: none;
      padding: 0 16px;
      padding-top: 0;
    }

    .fade-collapse {
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0 !important;
      max-height: 0 !important;
      margin-top: 0 !important;
      margin-bottom: 0 !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      transform: scale(0.9);
      overflow: hidden;
    }


    .view.active {
      display: block;
    }

    /* Task Animations */
    .task-anim-leave {
      animation: taskLeave 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      pointer-events: none;
      /* Prevent clicks during anim */
    }

    .task-anim-enter {
      animation: taskEnter 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes taskLeave {
      0% {
        opacity: 1;
        transform: scale(1) translateY(0);
        max-height: 100px;
        /* Approx height of task */
        margin-bottom: 0;
      }

      50% {
        opacity: 0;
        transform: scale(0.95) translateY(5px);
      }

      100% {
        opacity: 0;
        transform: scale(0.9) translateY(10px);
        max-height: 0;
        margin-bottom: 0;
        padding-top: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
    }

    @keyframes taskEnter {
      0% {
        opacity: 0;
        transform: scale(0.95) translateY(-5px);
      }

      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
  </style>
</head>

<body>

  <!-- REMOVED GLOBAL HEADER -->
  <!-- 
  <div class="header">
    <div class="header-title">Life OS</div>
  </div>
  -->

  <div class="main-container">

    <!-- TASKS VIEW -->
    <div id="view-tasks" class="view active">
      <div class="glass-header" style="display:flex; justify-content:space-between; align-items:center;">
        <div>ã‚¿ã‚¹ã‚¯</div>
        <div style="display:flex; gap:15px; align-items:center;">
          <div id="highlight-mode-btn"
            style="font-size:24px; color:#29B6F6; cursor:pointer; opacity:0.4; transition:all 0.2s;"
            onclick="toggleHighlightMode()">
            <span class="material-symbols-rounded">diamond</span>
          </div>
          <div style="font-size:24px; color:var(--primary); cursor:pointer;" onclick="toggleArchiveView()">ğŸ“‚</div>
        </div>
      </div>

      <!-- Main View -->
      <div id="task-main-view">
        <!-- High Prio -->
        <div class="section-container">
          <div class="section-header" onclick="toggleSection('high')">
            <div style="color:#FF6B6B; font-weight:bold;">é«˜ â–² (<span id="count-high">0</span>)</div>
            <div class="add-btn-small" onclick="event.stopPropagation(); openTaskModal(3)">ï¼‹</div>
          </div>
          <div id="list-high" class="list-content">
            <div></div>
          </div>
        </div>

        <!-- Med Prio -->
        <div class="section-container">
          <div class="section-header" onclick="toggleSection('med')">
            <div style="color:#E17055; font-weight:bold;">ä¸­ â— (<span id="count-med">0</span>)</div>
            <div class="add-btn-small" onclick="event.stopPropagation(); openTaskModal(2)">ï¼‹</div>
          </div>
          <div id="list-med" class="list-content">
            <div></div>
          </div>
        </div>

        <!-- Low Prio -->
        <div class="section-container">
          <div class="section-header" onclick="toggleSection('low')">
            <div style="color:#54A0FF; font-weight:bold;">ä½ â–¼ (<span id="count-low">0</span>)</div>
            <div class="add-btn-small" onclick="event.stopPropagation(); openTaskModal(1)">ï¼‹</div>
          </div>
          <div id="list-low" class="list-content">
            <div></div>
          </div>
        </div>

        <!-- Inbox -->
        <div class="section-container">
          <div class="section-header" onclick="toggleSection('none')">
            <div style="color:#888; font-weight:bold;">Inbox (<span id="count-none">0</span>)</div>
            <div class="add-btn-small" onclick="event.stopPropagation(); openTaskModal(0)">ï¼‹</div>
          </div>
          <div id="list-none" class="list-content">
            <div></div>
          </div>
        </div>

        <!-- Completed -->
        <div class="section-container completed">
          <div class="section-header" onclick="toggleSection('done')">
            <div style="color:#AAA; font-weight:bold;">å®Œäº† (<span id="count-done">0</span>)</div>
            <div class="add-btn-small" style="opacity:0; pointer-events:none;"></div>
          </div>
          <div id="list-done" class="list-content">
            <div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ARCHIVE VIEW -->
    <div id="view-archive" class="view">
      <div class="glass-header" style="display:flex; justify-content:space-between; align-items:center;">
        <div>ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</div>
        <div style="font-size:24px; cursor:pointer;" onclick="toggleArchiveView()">âœ•</div>
      </div>
      <div id="archive-list" style="padding-bottom:100px;"></div>
    </div>

    <!-- HABITS VIEW -->
    <div id="view-habits" class="view">
      <div class="glass-header" style="display:flex; justify-content:space-between; align-items:center;">
        <div>ç¿’æ…£</div>
        <div id="habit-date-display" style="font-size:16px; font-weight:600; color:var(--text-sub);"></div>
      </div>

      <div class="calendar-strip" id="calendar-strip">
        <!-- Loaded by JS -->
      </div>

      <div id="habit-sections-root">
        <!-- Dynamic Sections -->
      </div>

      <!-- Checked (Always last) -->
      <div class="section-habit" id="sec-wrapper-checked">
        <div class="section-header" onclick="toggleHabitSection('checked')">
          <div>å®Œäº† <span id="count-habit-checked" style="font-size:0.9em; opacity:0.8;"></span></div>
          <div class="toggle-icon">âˆ§</div>
        </div>
        <div id="list-habit-checked" class="habit-list-container">
          <div></div>
        </div>
      </div>
    </div>

    <!-- SCHEDULE VIEW -->
    <div id="view-schedule" class="view">
      <div class="glass-header">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
      <div style="text-align:center; margin-top:50px; color:#aaa;">
        Coming Soon...
      </div>
      <div id="schedule-list"></div>
    </div>


    <!-- ROADMAP VIEW (Restored) -->
    <div id="view-roadmap" class="view">
      <div class="glass-header" style="display:flex; justify-content:space-between; align-items:center;">
        <div>Roadmap</div>
        <div class="add-btn-small" onclick="openGoalModal()">+</div>
      </div>

      <div id="goal-list-container">
        <!-- JS Injected -->
      </div>
    </div>

    <!-- GOAL DETAIL VIEW (Full Screen) -->
    <!-- PROJECT VIEW -->
    <div id="view-projects" class="view">
      <div class="glass-header" style="display:flex; justify-content:space-between; align-items:center;">
        <div>Projects</div>
        <!-- Future: Add Project <div class="add-btn-small" onclick="openProjectModal()">+</div> -->
      </div>
      <div id="project-list-container"></div>
    </div>

    <!-- PROJECT DETAIL VIEW -->
    <div id="view-project-detail" class="view">
      <div class="glass-header" style="display:flex; align-items:center; gap:15px; padding-top:40px;">
        <div class="nav-back-btn" onclick="closeProjectDetail()"
          style="cursor:pointer; padding:5px; border-radius:50%; background:rgba(0,0,0,0.05);">
          <span class="material-symbols-rounded" style="font-size:24px; color:#555;">arrow_back</span>
        </div>
        <div id="pd-page-title"
          style="font-size:22px; font-weight:800; text-overflow:ellipsis; overflow:hidden; white-space:nowrap; flex:1;">
          Project Title
        </div>
      </div>

      <div id="pd-content" style="padding:20px 20px 100px;">
        <div id="pd-vision-card"
          style="background:#f9f9f9; padding:15px; border-radius:16px; margin-bottom:25px; color:#666; font-style:italic; line-height:1.6; border:1px solid #eee;">
        </div>
        <h3 style="font-size:18px; font-weight:800; margin-bottom:15px; color:#444;">Roadmaps</h3>
        <div id="pd-roadmap-list"></div>
      </div>
    </div>

    <!-- GOAL DETAIL VIEW (Full Screen) -->
    <div id="view-goal-detail" class="view">
      <!-- Header -->
      <div class="glass-header" style="display:flex; align-items:center; gap:15px; padding-top:40px;">
        <div class="nav-back-btn" onclick="closeGoalDetail()"
          style="cursor:pointer; padding:5px; border-radius:50%; background:rgba(0,0,0,0.05);">
          <span class="material-symbols-rounded" style="font-size:24px; color:#555;">arrow_back</span>
        </div>
        <div id="gd-page-title"
          style="font-size:22px; font-weight:800; text-overflow:ellipsis; overflow:hidden; white-space:nowrap; flex:1;">
          Goal Title
        </div>
      </div>

      <div id="gd-content" style="padding:20px 20px 100px;">
        <!-- Vision -->
        <div id="gd-vision-card"
          style="background:#f9f9f9; padding:15px; border-radius:16px; margin-bottom:25px; color:#666; font-style:italic; line-height:1.6; border:1px solid #eee;">
          Vision text...
        </div>

        <!-- Stats Card -->
        <div
          style="background:white; border-radius:20px; box-shadow:0 4px 20px rgba(0,0,0,0.05); padding:20px; margin-bottom:30px;">
          <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:15px;">
            <span style="font-size:12px; font-weight:700; color:#aaa; letter-spacing:1px;">PROGRESS</span>
            <div>
              <span id="gd-current-val" style="font-size:24px; font-weight:800; color:#333;">0</span>
              <span id="gd-target-val" style="font-size:14px; color:#999; margin-left:2px;">/ 100</span>
            </div>
          </div>

          <div class="progress-bar-bg"
            style="height:14px; background:#f0f0f0; border-radius:7px; overflow:hidden; margin-bottom:20px;">
            <div id="gd-progress-fill"
              style="width:0%; height:100%; background:linear-gradient(90deg, #42a5f5, #2196f3); transition:width 0.5s ease;">
            </div>
          </div>

          <button class="btn-main" onclick="openProgressFromDetailPage()"
            style="width:100%; display:flex; align-items:center; justify-content:center; gap:8px; padding:12px; background:var(--primary); color:white; border:none; border-radius:10px; font-weight:700; cursor:pointer;">
            <span class="material-symbols-rounded">edit_note</span>
            <span>é€²æ—ã‚’è¨˜éŒ²</span>
          </button>
        </div>

        <!-- History -->
        <h3 style="font-size:18px; font-weight:800; margin-bottom:15px; color:#444;">History</h3>
        <div id="gd-history-list" style="display:flex; flex-direction:column; gap:10px;">
          <!-- Items -->
        </div>
      </div>
    </div>

  </div> <!-- Main -->

  <!-- NAV BAR -->
  <div class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('tasks', this)">
      <div class="nav-icon">âœ“</div>
      Tasks
    </div>

    <!-- Roadmap (New) -->
    <div class="nav-item" onclick="switchTab('roadmap', this)">
      <div class="nav-icon"><span class="material-symbols-rounded">map</span></div>
      Roadmap
    </div>

    <!-- Project (New) -->
    <div class="nav-item" onclick="switchTab('projects', this)">
      <div class="nav-icon"><span class="material-symbols-rounded">rocket_launch</span></div>
      Project
    </div>

    <!-- Schedule (Cal) -->
    <div class="nav-item" onclick="switchTab('cal', this)">
      <div class="nav-icon"><span class="material-symbols-rounded">calendar_month</span></div>
      Schedule
    </div>

    <!-- Habits -->
    <div class="nav-item" onclick="switchTab('habits', this)">
      <div class="nav-icon">â­•</div>
      Habits
    </div>
  </div>



  <!-- TASK MODAL -->
  <div class="modal-overlay" id="task-modal" onclick="if(event.target===this) closeTaskModal()">
    <div class="modal-box">
      <h3 id="modal-title-task">ã‚¿ã‚¹ã‚¯è¿½åŠ </h3>
      <input id="t-id" type="hidden">
      <input id="t-name" class="input-std" placeholder="ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›">
      <select id="t-prio" class="input-std">
        <option value="3">å„ªå…ˆåº¦: é«˜</option>
        <option value="2">å„ªå…ˆåº¦: ä¸­</option>
        <option value="1">å„ªå…ˆåº¦: ä½</option>
        <option value="0" selected>ã‚¤ãƒ³ãƒœãƒƒã‚¯ã‚¹</option>
      </select>

      <div style="display:flex; gap:10px; margin-top:10px; align-items:center;">
        <input type="number" id="t-duration-h" class="input-std" placeholder="0" min="0"
          style="width:50px; text-align:center; padding:8px;"
          oninput="this.value = Math.max(0, parseInt(this.value) || 0)">
        <span style="font-size:12px; color:#666;">h</span>
        <input type="number" id="t-duration-m" class="input-std" placeholder="15" value="15" min="0" max="59"
          style="width:50px; text-align:center; padding:8px;"
          onchange="this.value = Math.max(0, Math.min(59, parseInt(this.value) || 0))">
        <span style="font-size:12px; color:#666;">m</span>
        <input type="date" id="t-date" class="input-std" style="flex:1; padding:8px;">
      </div>

      <textarea id="t-details" class="input-std" placeholder="è©³ç´°..."
        style="margin-top:10px; height:60px; resize:none; padding:8px; font-family:inherit;"></textarea>
      <button id="btn-save-task" class="btn-save" onclick="saveTask()">è¿½åŠ </button>
    </div>
  </div>
  <!-- GOAL MODAL -->
  <div class="modal-overlay" id="goal-modal" onclick="if(event.target===this) closeGoalModal()">
    <div class="modal-box" style="max-height:85vh; overflow-y:auto;">
      <h3>ç›®æ¨™è¨­å®š</h3>
      <input id="g-id" type="hidden">
      <label style="font-size:12px; color:#999;">ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input id="g-title" class="input-std" placeholder="ä¾‹: å‰¯æ¥­ã§æœˆ10ä¸‡ç¨¼ã">

      <label style="font-size:12px; color:#999;">ãƒ“ã‚¸ãƒ§ãƒ³ (å®šæ€§ç›®æ¨™)</label>
      <textarea id="g-vision" class="input-std" style="height:80px;" placeholder="é”æˆæ™‚ã®æƒ…æ™¯ãªã©..."></textarea>

      <div style="display:flex; gap:10px;">
        <div style="flex:1;">
          <label style="font-size:12px; color:#999;">å˜ä½ (ä¾‹: å††, kg)</label>
          <input id="g-metric-label" class="input-std" placeholder="å††">
        </div>
        <div style="flex:1;">
          <label style="font-size:12px; color:#999;">ç›®æ¨™å€¤</label>
          <input type="number" id="g-metric-target" class="input-std" placeholder="100000">
        </div>
      </div>

      <label style="font-size:12px; color:#999;">ç¾åœ¨å€¤</label>
      <input type="number" id="g-metric-current" class="input-std" placeholder="0">

      <div style="display:flex; gap:10px;">
        <div style="flex:1;">
          <label style="font-size:12px; color:#999;">é–‹å§‹æ—¥</label>
          <input type="date" id="g-start-date" class="input-std">
        </div>
        <div style="flex:1;">
          <label style="font-size:12px; color:#999;">é”æˆæœŸé™</label>
          <input type="date" id="g-end-date" class="input-std">
        </div>
      </div>

      <button class="btn-save" onclick="saveGoal()">ä¿å­˜</button>
    </div>
  </div>


  <!-- HABIT DETAIL MODAL -->
  <div id="habit-detail-modal" class="modal-fullscreen">
    <div class="detail-header">
      <div style="font-size:24px; cursor:pointer;" onclick="closeHabitDetail()">âœ•</div>
      <div style="font-size:24px; cursor:pointer;" onclick="openHabitSettings()">â‹¯</div>
    </div>

    <div class="detail-hero">
      <div class="detail-icon">ğŸ’§</div>
      <div class="detail-title" id="detail-name">Habit Name</div>
      <div style="color:#999; font-size:12px; margin-top:5px;" id="detail-time">Time</div>
      <div style="color:#777; margin-top:10px; font-size:13px;" id="detail-desc">Benefit...</div>
    </div>

    <div class="detail-stats-row">
      <div class="stat-box">
        <div class="stat-num" id="detail-streak">-</div>
        <div class="stat-label">é€£ç¶šæ—¥æ•°</div>
      </div>
      <div class="stat-box">
        <div class="stat-num" id="detail-rate">-%</div>
        <div class="stat-label">æœˆé–“é”æˆç‡</div>
      </div>
    </div>

    <div class="calendar-card">
      <div class="section-header">
        <span>ã‚¿ã‚¹ã‚¯</span>
      </div>
      <div class="cal-header">
        <span id="btn-prev-month" class="cal-arrow" onclick="changeDetailMonth(-1)">â€¹</span>
        <span id="cal-month-label">2025å¹´ 12æœˆ</span>
        <span id="btn-next-month" class="cal-arrow next" onclick="changeDetailMonth(1)">â€º</span>
      </div>
      <div class="detail-cal-grid" id="detail-cal-grid">
        <!-- JS -->
      </div>
    </div>

    <div id="detail-journal-logs-container" style="margin:20px 20px 100px 20px;"></div>
  </div>

  <!-- HABIT SETTINGS MODAL -->
  <div class="modal-overlay" id="habit-settings-modal" onclick="if(event.target===this) closeHabitSettings()">
    <div class="modal-box">
      <h3>ç¿’æ…£è¨­å®š</h3>

      <div style="display:flex; gap:10px; align-items:center; margin-bottom:15px;">
        <div id="hs-icon-preview" onclick="openIconPicker()"
          style="width:50px; height:50px; background:#f0f0f0; border-radius:12px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:24px;">
          <span class="material-symbols-rounded">add_reaction</span>
        </div>
        <div style="flex:1;">
          <label style="font-size:12px; color:#999;">ç¿’æ…£å</label>
          <input id="hs-name" class="input-std" style="margin-top:2px;">
        </div>
      </div>

      <label style="font-size:12px; color:#999;">ã‚»ã‚¯ã‚·ãƒ§ãƒ³</label>
      <select id="hs-section" class="input-std"></select>

      <div style="margin-top:10px; display:flex; gap:10px;">
        <div style="flex:1;">
          <label style="font-size:12px; color:#999;">æ‰€è¦æ™‚é–“ (ä¾‹: 15m)</label>
          <input id="hs-time" class="input-std" placeholder="15m">
        </div>
      </div>

      <div style="margin-top:10px;">
        <label style="font-size:12px; color:#999;">ãƒ¡ãƒªãƒƒãƒˆãƒ»åŠ¹æœ</label>
        <textarea id="hs-benefit" class="input-std" rows="2" placeholder="ã“ã®ç¿’æ…£ã‚’è¡Œã†ãƒ¡ãƒªãƒƒãƒˆã¯ï¼Ÿ"></textarea>
      </div>

      <!-- Advanced Toggle -->
      <div class="toggle-switch-container">
        <span class="toggle-label">2æ®µéšè¨­å®š (æ”»ã‚ãƒ»å®ˆã‚Š)</span>
        <label class="toggle-switch">
          <input type="checkbox" id="hs-advanced-toggle" onchange="toggleAdvancedSettings()">
          <span class="slider"></span>
        </label>
      </div>

      <!-- Advanced Fields -->
      <div id="hs-advanced-settings">
        <label style="font-size:12px; color:#999; display:block; margin-bottom:4px;">æ”»ã‚ã®ç¿’æ…£ã‚¿ã‚¤ãƒˆãƒ«</label>
        <input id="hs-offense-title" class="input-std">

        <label style="font-size:12px; color:#999; display:block; margin-top:10px; margin-bottom:4px;">æ”»ã‚ã®æ‰€è¦æ™‚é–“</label>
        <input id="hs-offense-time" class="input-std">
      </div>

      <button class="btn-save" onclick="saveHabitDefinition()">ä¿å­˜</button>
    </div>
  </div>

  <!-- ICON PICKER MODAL -->
  <div class="modal-overlay" id="icon-picker-modal" onclick="if(event.target===this) closeIconPicker()">
    <div class="modal-box" style="max-height:80vh; overflow-y:auto;">
      <h3>ã‚¢ã‚¤ã‚³ãƒ³é¸æŠ</h3>

      <!-- TABS -->
      <div style="display:flex; margin-bottom:15px; background:#f0f0f0; border-radius:8px; padding:4px;">
        <div id="tab-material" onclick="switchIconTab('material')"
          style="flex:1; text-align:center; padding:8px; border-radius:6px; background:white; font-weight:bold; cursor:pointer;">
          Material
        </div>
        <div id="tab-emoji" onclick="switchIconTab('emoji')"
          style="flex:1; text-align:center; padding:8px; border-radius:6px; color:#666; cursor:pointer;">
          Emoji
        </div>
      </div>

      <input type="text" id="icon-search" placeholder="æ¤œç´¢..." oninput="filterIcons(this.value)"
        style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd; margin-bottom:15px;">

      <div id="icon-grid" style="display:grid; grid-template-columns:repeat(5, 1fr); gap:10px;">
        <!-- JS -->
      </div>
    </div>
  </div>

  <!-- SECTION MANAGER MODAL -->
  <div class="modal-overlay" id="section-manager-modal" onclick="if(event.target===this) closeSectionManager()">
    <div class="modal-box" style="max-height:80vh; overflow-y:auto;">
      <h3>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†</h3>
      <div id="sm-list" style="margin-bottom:20px;"></div>

      <button class="btn-save" style="background:#ddd; color:#333; margin-bottom:10px;" onclick="addSectionRow()">+
        ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ </button>
      <button class="btn-save" onclick="saveSections()">å¤‰æ›´ã‚’ä¿å­˜</button>
    </div>
  </div>

  <!-- SSR DATA CONTAINERS -->
  <script id="ssr-data-tasks" type="application/json"><?!= initialTasksJson ?></script>
  <script id="ssr-data-habits" type="application/json"><?!= initialHabitsJson ?></script>
  <script id="ssr-data-error" type="application/json"><?!= ssrError ?></script>

  <?!= include('js'); ?>
  <?!= include('icons'); ?>
  <?!= include('emojis'); ?>

  <style>
    .cal-cell.status-failed {
      background: #F4F4F4;
      /* Light Gray Solid */
      color: #555;
      border: none;
      /* No Ring */
    }

    /* 2-Level Habit Styles */
    .habit-item.status-advanced .habit-icon {
      background-color: #EF5350 !important;
      /* Red */
      color: white !important;
    }

    .habit-item.status-advanced .habit-name {
      /* color: #B71C1C !important; REMOVED per user request (Keep Black) */
      color: var(--text) !important;
      font-weight: 700;
    }

    /* Dim Completed Items */
    .habit-item.done {
      opacity: 0.5;
      /* filter: grayscale(100%); REMOVED per user request */
      transition: all 0.3s ease;
    }


    .cal-cell.status-advanced {
      background-color: #FFCDD2;
      /* Light Red */
      color: #B71C1C;
      font-weight: bold;
    }

    /* Today Unfinished */
    .cal-cell.status-today-incomplete {
      background: #F4F4F4;
      /* Matched Light Gray */
      color: var(--warm-orange);
      /* Orange Text */
      border: none;
      font-weight: 800;
    }

    .task-wrapper {
      position: relative;
      margin-bottom: 12px;
      /* Restore vertical gap */
      overflow: visible;
      /* Allow actions to be seen when swiped (controlled by opacity) */
      /* Wait, if visible, bleed happens? No, opacity 0 handles bleed. */
      /* Actually overflow: hidden clips 12px corners? Yes. */
      /* Let's keep overflow hidden to clip the actions to the card shape if opacity fails? */
      /* No, if we want actions to slide out? */
      /* Actions are inside wrapper. */
      overflow: hidden;
      border-radius: 12px;
      /* Restore rounded corners */
      background: transparent;
      border-bottom: none;
      /* No separator */
    }

    .task-item {
      /* Ensure it sits on top */
      position: relative;
      z-index: 2;
      background: #FFF !important;
      /* solid bg to cover actions */
      transition: transform 0.3s ease;
      margin-bottom: 0 !important;
      /* Wrapper creates spacing */
      padding: 12px 14px;
      /* Match header */
    }

    .task-actions {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: 140px;
      display: flex;
      z-index: 1;
      opacity: 0;
      /* HIDDEN BY DEFAULT TO PREVENT BLEED */
      transition: opacity 0.1s ease;
    }

    .action-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      color: white;
    }

    .action-btn.archive {
      background-color: #64B5F6;
      /* Blue for Archive */
    }

    .action-btn.unarchive {
      background-color: #8D6E63;
      /* Brown/Gray for Restore */
    }

    .action-btn.delete {
      background-color: #EF5350;
      /* Red for Delete */
    }

    /* Toggle Switch */
    .toggle-switch-container {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      /* Right aligned */
      margin-top: 15px;
      margin-bottom: 10px;
    }

    .toggle-label {
      font-size: 12px;
      color: #666;
      margin-right: 8px;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 36px;
      height: 20px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: #2196F3;
    }

    input:checked+.slider:before {
      transform: translateX(16px);
    }

    /* Advanced Settings Container */
    #hs-advanced-settings {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 15px;
      display: none;
      /* Hidden by default */
      border: 1px solid #eee;
    }

    /* Small Add Button in Header */
    .add-btn-small {
      font-size: 20px;
      color: #777;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .add-btn-small:active {
      background: #eee;

    }

    /* Roadmap Styles */
    .goal-card {
      background: white;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
      position: relative;
      overflow: hidden;
    }

    .goal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .goal-title {
      font-size: 18px;
      font-weight: 800;
      color: #333;
      margin-bottom: 5px;
    }

    .goal-vision {
      font-size: 13px;
      color: #666;
      line-height: 1.5;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 12px;
      margin-bottom: 15px;
      font-style: italic;
    }

    .progress-container {
      background: #F0F0F0;
      height: 8px;
      border-radius: 4px;
      margin-top: 10px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #64B5F6, #1E88E5);
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .goal-metrics {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #888;
      margin-top: 5px;
      font-weight: 700;
    }

    .goal-dates {
      font-size: 11px;
      color: #AAA;
      margin-top: 15px;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .milestone-dots {
      display: flex;
      gap: 4px;
      margin-top: 10px;
    }

    .m-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #eee;
    }

    .m-dot.done {
      background: #81C784;
    }

    .m-dot.done {
      background: #81C784;
    }

    /* Project Cards */
    .project-card {
      background: white;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
      position: relative;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .project-card:active {
      transform: scale(0.98);
    }

    .project-title {
      font-size: 18px;
      font-weight: 800;
      color: #333;
      margin-bottom: 8px;
    }

    .project-vision {
      font-size: 13px;
      color: #777;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .current-roadmap-tag {
      background: #E3F2FD;
      color: #1565C0;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      display: inline-block;
    }


    /* Fix Bottom Nav for 5 items (Robust Flex) */
    .bottom-nav {
      display: flex !important;
      flex-direction: row !important;
      justify-content: space-around !important;
      align-items: center !important;
      width: 100% !important;
      height: 70px !important;
      /* Fixed Height */
      padding: 0 5px !important;
      box-sizing: border-box !important;
      gap: 0 !important;
    }

    .nav-item {
      flex: 1 1 0px !important;
      /* Forces equal width */
      width: 0 !important;
      /* Robustness for old browsers */
      min-width: 0 !important;
      max-width: none !important;
      height: 100% !important;
      padding: 5px 0 !important;
      margin: 0 !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
    }
  </style>
  <!-- Consolidated Scripts (Moved to Head) -->

  <!-- MEASUREMENT MODAL -->
  <div class="modal-overlay" id="measurement-modal" onclick="if(event.target===this) closeMeasurementModal()">
    <div class="modal-box">
      <h3 id="mm-title">Metric Name</h3>
      <div id="mm-subtitle" style="font-size:12px; color:#999; margin-bottom:15px;">Goal Title</div>

      <label style="font-size:12px; color:#666;">Value (Today)</label>
      <input id="mm-value" type="number" class="input-std" placeholder="e.g. 5">

      <label style="font-size:12px; color:#666; margin-top:10px; display:block;">Comment</label>
      <input id="mm-comment" type="text" class="input-std" placeholder="Optional">

      <button class="btn-save" style="margin-top:20px;" onclick="saveMeasurement()">Log</button>
    </div>
  </div>
  <!-- GOAL WIZARD MODAL -->
  <div class="modal-overlay" id="goal-wizard-modal" onclick="if(event.target===this) closeGoalWizard()">
    <div class="modal-box" style="min-height:300px; display:flex; flex-direction:column;">
      <div style="flex:1;">
        <h3 style="margin-bottom:5px;">é€±é–“ãƒ—ãƒ©ãƒ³ ğŸ—“ï¸</h3>
        <div style="font-size:12px; color:#999; margin-bottom:20px;">ä»Šé€±æ³¨åŠ›ã™ã‚‹ç›®æ¨™ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚</div>

        <!-- Step 1: Select Parent Goal -->
        <div id="gw-step-1">
          <label class="label-std">ç›®æ¨™ï¼ˆVisionï¼‰ã‚’é¸æŠ</label>
          <select id="gw-goal-select" class="input-std" onchange="checkGwGoalSelect()">
            <option value="">èª­ã¿è¾¼ã¿ä¸­...</option>
          </select>

          <div id="gw-new-goal-container" style="display:none; margin-top:10px;">
            <label class="label-std">æ–°ã—ã„ç›®æ¨™ã®ã‚¿ã‚¤ãƒˆãƒ«</label>
            <input id="gw-new-goal-title" class="input-std" placeholder="ä¾‹: Pythonã‚’ãƒã‚¹ã‚¿ãƒ¼ã™ã‚‹">
          </div>
        </div>

        <!-- Step 2: Define Weekly Target -->
        <div id="gw-step-2" style="display:none;">
          <label class="label-std">ä»Šé€±ã®æ¸¬å®šæŒ‡æ¨™ï¼ˆMetricï¼‰</label>
          <input id="gw-metric-name" class="input-std" placeholder="ä¾‹: èª­æ›¸ãƒšãƒ¼ã‚¸æ•°, å‹‰å¼·æ™‚é–“">

          <label class="label-std" style="margin-top:15px;">ç›®æ¨™æ•°å€¤ï¼ˆTargetï¼‰</label>
          <div style="display:flex; align-items:center; gap:10px;">
            <input id="gw-target-value" type="number" class="input-std" style="flex:1;" placeholder="10">
            <span style="font-size:12px; color:#666;">åˆè¨ˆ</span>
          </div>

          <label class="label-std" style="margin-top:15px;">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
          <input id="gw-notes" class="input-std" placeholder="æˆ¦ç•¥ã‚„æ„æ°—è¾¼ã¿...">
        </div>
      </div>

      <!-- Footer Buttons -->
      <div style="display:flex; justify-content:space-between; margin-top:20px;">
        <button id="gw-btn-back" class="btn-save"
          style="background:#eee; color:#555; width:auto; padding:0 20px; display:none;"
          onclick="gwPrevStep()">æˆ»ã‚‹</button>
        <div style="flex:1;"></div>
        <button id="gw-btn-next" class="btn-save" style="width:auto; padding:0 30px;" onclick="gwNextStep()">æ¬¡ã¸</button>
      </div>
    </div>
  </div>
  <!-- PROGRESS MODAL -->
  <div class="modal-overlay" id="progress-modal" onclick="if(event.target===this) closeProgressModal()">
    <div class="modal-box">
      <h3 id="pm-title">Progress Log</h3>
      <div style="font-size:12px; color:#999; margin-bottom:15px;" id="pm-subtitle">Goal Title</div>

      <label class="label-std">ç¾åœ¨ã®åˆ°é”å€¤ (Snapshot)</label>
      <div style="display:flex; align-items:center;">
        <input id="pm-value" type="number" class="input-std" placeholder="">
      </div>

      <label class="label-std">ãƒ¡ãƒ¢ (Notes)</label>
      <input id="pm-notes" class="input-std" placeholder="é€²æ—ã®ã‚³ãƒ¡ãƒ³ãƒˆ...">

      <button class="btn-save" style="margin-top:20px;" onclick="saveGoalProgress()">è¨˜éŒ²ã‚’ä¿å­˜</button>
    </div>
  </div>

  <!-- JOURNAL MODAL (Restored) -->
  <div class="modal-overlay" id="journal-modal" onclick="if(event.target===this) closeJournalModal()">
    <div class="modal-box">
      <h3 id="journal-title">æŒ¯ã‚Šè¿”ã‚Š</h3>
      <div style="font-size:12px; color:#999; margin-bottom:15px;" id="journal-subtitle"></div>

      <textarea id="journal-input" class="input-std" rows="4" placeholder="ä¸€è¨€ãƒ¡ãƒ¢..."></textarea>

      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
        <button class="btn-sec" onclick="closeJournalModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-save" onclick="submitJournal()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- EDIT NOTE MODAL -->
  <div class="modal-overlay" id="edit-note-modal" onclick="if(event.target===this) closeEditNoteModal()">
    <div class="modal-box">
      <h3>ãƒ¡ãƒ¢ã®ç·¨é›†</h3>
      <input id="en-id" type="hidden">
      <textarea id="en-text" class="input-std" style="height:100px; resize:none;" placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›..."></textarea>

      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
        <button class="btn-sec" onclick="closeEditNoteModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-save" style="width:auto; padding:0 20px;" onclick="saveEditedNote()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- SLEEP MODAL (Restored) -->
  <div class="modal-overlay" id="sleep-modal" onclick="if(event.target===this) closeSleepModal()">
    <div class="modal-box">
      <h3>ç¡çœ è¨˜éŒ²</h3>
      <div style="margin-bottom:20px;">
        <label style="display:block; font-size:12px; color:#666; margin-bottom:5px;">å°±å¯ or é–‹å§‹æ™‚åˆ» (Bedtime)</label>
        <input type="time" id="slp-time-start" class="input-std" value="23:00" style="font-size:16px;">
      </div>
      <div style="margin-bottom:20px;">
        <label style="display:block; font-size:12px; color:#666; margin-bottom:5px;">èµ·åºŠ or çµ‚äº†æ™‚åˆ» (Wakeup)</label>
        <input type="time" id="slp-time-end" class="input-std" value="07:00" style="font-size:16px;">
      </div>

      <div style="display:flex; justify-content:flex-end; gap:10px;">
        <button class="btn-sec" onclick="closeSleepModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-save" onclick="commitSleepLog()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- EDIT VISION MODAL -->
  <div class="modal-overlay" id="edit-vision-modal" onclick="if(event.target===this) closeEditVisionModal()">
    <div class="modal-box">
      <h3>ãƒ“ã‚¸ãƒ§ãƒ³ã®ç·¨é›†</h3>
      <input id="ev-id" type="hidden">
      <textarea id="ev-text" class="input-std" style="height:120px; resize:none;" placeholder="ãƒ“ã‚¸ãƒ§ãƒ³ã‚’å…¥åŠ›..."></textarea>

      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
        <button class="btn-sec" onclick="closeEditVisionModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-save" style="width:auto; padding:0 20px;" onclick="saveEditedVision()">ä¿å­˜</button>
      </div>
    </div>
  </div>


  <!-- GOAL DETAIL MODAL -->
  <div class="modal-overlay" id="goal-detail-modal-overlay" onclick="if(event.target===this) closeGoalDetail()">
    <div class="modal-box" style=" max-width: 500px; width: 90%;">
      <div style="display:flex; justify-content:space-between; align-items:flex-start;">
        <h2 id="gdm-title" style="margin:0; font-size:20px; font-weight:bold; color:#34495e;">Goal Title</h2>
        <button onclick="closeGoalDetail()"
          style="background:none; border:none; color:#999; font-size:24px; cursor:pointer;">&times;</button>
      </div>

      <div id="gdm-vision"
        style="color:#7f8c8d; font-size:14px; margin-top:5px; margin-bottom:20px; white-space: pre-wrap;">Vision Text
      </div>

      <div class="stat-card" style="margin-bottom:20px;">
        <div style="font-size:12px; color:#95a5a6; margin-bottom:5px;">PROGRESS</div>
        <div style="display:flex; justify-content:space-between; align-items:baseline;">
          <span id="gdm-current" style="font-size:24px; font-weight:bold; color:#2c3e50;">0</span>
          <span id="gdm-target" style="font-size:16px; color:#7f8c8d;">/ 100</span>
        </div>
        <div style="background:#ecf0f1; height:8px; border-radius:4px; margin-top:10px; overflow:hidden;">
          <div id="gdm-bar" style="background:#3498db; height:100%; width:0%;"></div>
        </div>
      </div>

      <div style="display:flex; gap:10px; margin-bottom:20px;">
        <button class="btn-save" style="flex:1; background:#3498db;" onclick="openProgressFromDetail()">ğŸ“Š
          é€²æ—ã‚’è¨˜éŒ²</button>
        <!-- Future: Edit Goal Button -->
      </div>

      <h4 style="margin:0 0 10px 0; color:#34495e; font-size:14px;">History</h4>
      <div id="gdm-history-list"
        style="max-height:200px; overflow-y:auto; background:#f9f9f9; border-radius:8px; padding:10px;">
        <div style="text-align:center; color:#ccc; font-size:12px;">No logs yet</div>
      </div>
    </div>
  </div>
</body>

</html>